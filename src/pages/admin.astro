---
const user = import.meta.env.ADMIN_USER || process.env.ADMIN_USER;
const pass = import.meta.env.ADMIN_PASSWORD || process.env.ADMIN_PASSWORD;

if (user && pass) {
  const auth = Astro.request.headers.get('authorization');
  if (!auth) {
     return new Response('Unauthorized', {
       status: 401,
       headers: { 'WWW-Authenticate': 'Basic realm="Admin Access"' }
     });
  }

  const [scheme, encoded] = auth.split(' ');
  if (!encoded || scheme !== 'Basic') {
      return new Response('Bad Request', { status: 400 });
  }

  const buffer = Buffer.from(encoded, 'base64');
  const [u, p] = buffer.toString().split(':');

  if (u !== user || p !== pass) {
      return new Response('Forbidden', { status: 403 });
  }
}
---
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Content Manager</title>
  <link href="/admin/config.yml" type="text/yaml" rel="cms-config-url">
  <script src="https://unpkg.com/decap-cms@3.10.0/dist/decap-cms.js"></script>
</head>
<body>
</body>
</html>
